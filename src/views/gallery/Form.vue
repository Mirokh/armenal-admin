<template>  <div class="row q-py-md q-px-md justify-between">    <h5 class="q-ma-xs">      Gallery    </h5>  </div>  <q-separator inset class="q-my-sm"/>  <div class="q-pa-md">    <div class="q-gutter-y-md">      <q-tabs          v-model="lang"          inline-label          align="left"          class="text-grey"      >        <q-tab name="am">          <q-icon size="sm">            <img :src="armFlag" alt="">          </q-icon>        </q-tab>        <q-tab name="ru">          <q-icon size="sm">            <img :src="rusFlag" alt="">          </q-icon>        </q-tab>        <q-tab name="en">          <q-icon size="sm">            <img :src="ukFlag" alt="">          </q-icon>        </q-tab>      </q-tabs>    </div>  </div>  <div class="q-pa-md">    <q-form        class="q-gutter-md"        @submit="saveForm"        @reset="resetForm"        ref="galleryForm"    >      <q-tab-panels v-model="lang">        <q-tab-panel name="am">          <div class="col-3 col-sm-12 col-lg-4 col-xl-3 col-xs-12 col-md-6 q-pa-sm">            <q-input                ref="titleAm"                v-model="form.title.am"                stack-label                filled                label="Title *"                lazy-rules="ondemand"            />          </div>        </q-tab-panel>        <q-tab-panel name="ru">          <div class="col-3 col-sm-4 col-xs-3 q-pa-sm">            <q-input                ref="titleRu"                v-model="form.title.ru"                stack-label                filled                label="Title *"                lazy-rules="ondemand"            />          </div>        </q-tab-panel>        <q-tab-panel name="en">          <div class="col-3 col-sm-4 col-xs-3 q-pa-sm">            <q-input                ref="titleEn"                v-model="form.title.en"                stack-label                filled                label="Title *"                lazy-rules="ondemand"            />          </div>        </q-tab-panel>      </q-tab-panels>      <div class="q-pa-sm">        <div class="q-col-gutter-md row items-start">          <div class="col-2 col-lg-2 col-md-3 col-sm-12 col-xs-12 relative-position" v-for="item of form.galleryItems" :key="item.id">            <q-icon name="close" color="grey" class="remove-file" @click="removeImage(item.id, true)"/>            <q-img :src="imagePath(item.path)" class="gallery-items"></q-img>          </div>          <div class="col-2 relative-position" v-for="image of imagePreviews" :key="image">            <q-icon name="close" color="grey" class="remove-file" @click="removeImage(image.name)" />            <q-badge v-if="notSavedFiles" rounded floating color="green" class="new-uploaded" />            <q-img :src="image.preview" class="gallery-items"></q-img>          </div>          <div class="col-2">            <label class="files-input" for="files-input">              <q-icon name="add" size="xl" color="grey"></q-icon>            </label>            <input type="file" id="files-input" @change="previewFile" multiple>          </div>        </div>      </div>      <div class="q-pa-sm">        <q-btn label="Save" type="submit" color="primary"/>        <q-btn label="Reset" type="reset" color="primary" flat class="q-ml-sm"/>      </div>    </q-form>  </div></template><script>import armFlag from '../../assets/armenia.png'import rusFlag from '../../assets/russia.png'import ukFlag from '../../assets/united-kingdom.png'import {useQuasar} from "quasar";export default {  name: "GalleryIndex",  data() {    return {      armFlag,      rusFlag,      ukFlag,      images: null,      lang: 'am',      galleryId: null,      imagePreviews: [],      files: [],      form: {        title: {          ru: '',          am: '',          en: ''        },        galleryItems: []      },      notSavedFiles: false,    }  },  async created() {    this.galleryId = this.$route.params?.id    this.form = (await this.$http.get(`gallery/${this.galleryId}`)).data  },  computed: {    token() {      return localStorage.getItem('auth')    }  },  methods: {    required(val) {      return (val && val.length > 0 || 'This field is required')    },    async saveForm() {      const payload = { title: this.form.title };      if (!this.token) {        console.error('unauthorized')        return      }      let headers = {        'Authorization': `Bearer ${this.token}`      };      if (this.galleryId) { // updating        this.$http.patch(`gallery/${this.galleryId}`, payload, {headers}).then(() => {          this.saveImages();          this.$q.notify({            position: 'top-right',            type: 'positive',            message: 'Gallery successfully updated'          })        }).catch(error => {          const message = error.response.data.message;          this.$q.notify({            position: 'top-right',            type: 'negative',            message: message.length ? message[0] : 'Unhandled error'          })        })      } else { // creating        const gallery = (await this.$http.post(`gallery`, payload, {headers})).data        this.galleryId = gallery.id        this.$q.notify({          position: 'top-right',          type: 'positive',          message: 'Gallery successfully created'        })      }    },    async saveImages() {      const files = document.getElementById('files-input').files;      if (files.length) {        const formData = new FormData();        // Append each file to the FormData object        for (let i = 0; i < files.length; i++) {          formData.append('galleryItems', files[i]);        }        let headers = {          'Content-Type': 'multipart/form-data',          'Authorization': `Bearer ${this.token}`,        };        await this.$http.post(`gallery/${this.galleryId}/items`, formData,{headers})        this.notSavedFiles = false;      }    },    imagePath(path) {      return `${process.env.VUE_APP_API_URL}/${path}`    },    previewFile(e) {      const files = e.target.files;      for (let file of files) {        this.imagePreviews.push({preview: URL.createObjectURL(file), name: file.name});      }      this.notSavedFiles = true;    },    resetForm() {      this.form.title = {        am: '',        ru: '',        en: ''      };      this.imagePreviews = []    },    removeImage(item, process = false) {      if (process) {        if (!this.token) {          console.error('unauthorized')          return        }        const headers = {          'Content-Type': 'multipart/form-data',          'Authorization': `Bearer ${this.token}`        };        this.$http.delete(`/gallery/gallery-items/${item}`, {headers}).then(() => {          const index = this.form.galleryItems.findIndex(i => {            return i.id = item          })          if (index !== -1) {            this.form.galleryItems.splice(index, 1);          }          this.$q.notify({            position: 'top-right',            type: 'positive',            message: 'Image successfully deleted'          })        }).catch(error => {          const message = error.response.data.message;          this.$q.notify({            position: 'top-right',            type: 'negative',            message: message.length ? message[0] : 'Unhandled error'          })        })     } else {        const fileInput = document.getElementById('files-input');        const newFiles = [];        const index = this.imagePreviews.findIndex(i => {          return i.name === item        });        if (index !== -1) {          this.imagePreviews.splice(index, 1);          for (let file of fileInput.files) {            if (file.name !== item) {              newFiles.push(file)            }          }          const dataTransfer = new DataTransfer();          newFiles.forEach((file) => {            dataTransfer.items.add(file);          });          document.getElementById('files-input').files = dataTransfer.files        }      }    },    setup() {      const $q = useQuasar();      return {        $q      }    }  }}</script><style scoped>.gallery-items, .files-input {  height: 150px;  object-fit: cover;  border-radius: 4px;}.new-uploaded {  top: 26px;  right: 10px;  z-index: 10;}.files-input {  border: 1px solid lightgray;  cursor: pointer;  display: flex;  align-items: center;  justify-content: center;}.files-input:hover {  opacity: 0.8;}#files-input {  display: none;}.remove-file {  cursor: pointer;  position: absolute;  bottom: 7px;  right: 7px;  z-index: 10;  border-radius: 50%;  padding: 3px;  background: #fff;}.q-tab-panel {  padding: 0;}</style>